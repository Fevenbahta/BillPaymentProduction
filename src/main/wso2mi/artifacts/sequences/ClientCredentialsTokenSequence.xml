<sequence xmlns="http://ws.apache.org/ns/synapse" name="ClientCredentialsTokenSequence">
    <log level="full">
        <property name="Status" value="Calling Token Endpoint using Client Credentials"/>
    </log>

    <!-- Set headers -->

<payloadFactory media-type="xml">
    <format>
        <auth>
            <grant_type>client_credentials</grant_type>
            <client_id>service-dbs-confirmables</client_id>
            <client_secret>4fd191f816f872d539e7da803db59617</client_secret>
        </auth>
    </format>
</payloadFactory>

<header name="Content-Type" scope="transport" value="application/x-www-form-urlencoded"/>
<property name="messageType" scope="axis2" type="STRING" value="application/x-www-form-urlencoded"/>
    <property name="DISABLE_CHUNKING" scope="axis2" type="STRING" value="true"/>
   <log level="full"/>
<call>
    <endpoint>
        <http method="POST" uri-template="https://idp.anbesabank.et/auth/realms/neo-customer/protocol/openid-connect/token"/>
    </endpoint>
</call>


    <!-- Log the response -->
    <log level="full">
        <property name="TokenResponse" expression="get-property('axis2','HTTP_SC')"/>
        <property name="ResponsePayload" expression="$body"/>
    </log>

    <!-- Do whatever you want with the token here (store it, extract it, etc.) -->
    <property name="accessToken" expression="json-eval($.access_token)" scope="default" type="STRING"/>

    <!-- Optionally log the extracted token -->
    <log level="custom">
        <property name="ExtractedAccessToken" expression="get-property('access_token')"/>
    </log>
</sequence>
